<!--%c ssr_template_default_before(ssr_sb, ssr_data); %-->

<div class="rcontent">
	<div class="rbox">
		<h2>
			<!--%c
				SSR_EN_PRINTF("Ask me, bro");
				SSR_RU_PRINTF("Задай вопрос, бро");
			%-->
		</h2>
		<div style="display: flex; justify-content: center; gap: 10px;">
			<input id="askme_question" type="text" autocomplete="off" placeholder='<!--%cSSR_EN_PRINTF("Question text"); SSR_RU_PRINTF("Текст вопроса");%-->'></input>
			<button id="askme_send_btn" onclick="SendAskmeQuestion()">Send</button>
		</div>
		<p id="askme_result"></p>
	</div>
</div>
<script src="enums.js"></script> <!-- Generated -->
<script src="utils/binary_rw.js"></script>
<script>
	const askme_question_el = document.getElementById("askme_question");
	const askme_result_el = document.getElementById("askme_question");
	const askme_send_btn_el = document.getElementById("askme_send_btn");
	askme_question_el.addEventListener("keydown", function(event) {
		if (event.key === "Enter") {
			event.preventDefault();
			askme_send_btn_el.click();
		}
	});
	function SendAskmeQuestion() {
		const writer = new ByteWriter();
		writer.u16(CME.ASKME_QUESTION);
		writer.str(askme_question_el.value);
		ws.send(writer.bytes())
	}
	function HandleAskmeResponce(reader) {
		var success = reader.u8();
		switch (success) {
			case 0:
				askme_result.innerHTML = `
					<!--%c SSR_RU_PRINTF("Вопрос успешно отправлен."); %-->
					<!--%c SSR_EN_PRINTF("Question sent successefuly."); %-->
				`;
				break;
			case 1:
				askme_result.innerHTML = `
					<!--%c SSR_RU_PRINTF("Ошибка. Вопрос слишком длинный!"); %-->
					<!--%c SSR_EN_PRINTF("Error. Question is too long!"); %-->
				`;
				break;
			case 2:
				askme_result.innerHTML = `
					<!--%c SSR_RU_PRINTF("Ошибка. Вопрос пустой!"); %-->
					<!--%c SSR_EN_PRINTF("Error. Question empty!"); %-->
				`;
				break;
			case 3:
				askme_result.innerHTML = `
					<!--%c SSR_RU_PRINTF("Ошибка. Слишком часто отправляешь!"); %-->
					<!--%c SSR_EN_PRINTF("Error. Sending too frequently!"); %-->
				`;
				break;
		}
	}
	// --- WebSockets ---
	const ws_proto = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
	const ws = new WebSocket(`${ws_proto}//${window.location.host}/ws`);
	//const ws = new WebSocket(`ws://${location.host}/ws`);
	ws.binaryType = "arraybuffer";
	ws.onopen = () => { console.log('WS: open'); };
	ws.onmessage = (event) => {
		const reader = new ByteReader(event.data);
		var msg_type = reader.u8();
		if (msg_type == SME.ASKME_RESPONCE) { HandleAskmeResponce(reader); }
	}
	ws.onclose = (err) => {
		askme_result.innerHTML = `
			<!--%c SSR_RU_PRINTF("Ошибка. Не удалось подключится к серверу по веб-сокетам! Попробуй другое устройство или проверь настройки браузера."); %-->
			<!--%c SSR_EN_PRINTF("Error. Failed to connect to the server over web sockets! Try another device or check browser settings."); %-->
		`;
	};
</script>

<!--%c ssr_template_default_after(ssr_sb, ssr_data); %-->
